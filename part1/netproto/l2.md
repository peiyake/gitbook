# 链路层协议

本文内容主要摘自《TCP/IP详解-卷1》，简单总结罗列部分内容，方便自己查阅

>在T C P / I P协议族中，链路层主要有三个目的：（1）为I P模块发送和
接收I P数据报；（ 2）为A R P模块发送A R P请求和接收A R P应答；（3）为R A R P发送R A R P请
求和接收R A R P应答。T C P / I P支持多种不同的链路层协议，这取决于网络所使用的硬件，如以
太网、令牌环网、F D D I（光纤分布式数据接口）及R S-2 3 2串行线路等。

## 以太网、IEEE802报文封装

以太网协议的封装应该是最常用、最熟悉的了，字段释义就不介绍了，直接附上书本上的报文格式图

![以太网及IEEE802报文格式](./images/l2_1.png)

## PPP串行链路层协议封装

P P P，点对点协议修改了S L I P协议中的所有缺陷。P P P包括以下三个部分：
1) 在串行链路上封装I P数据报的方法。P P P既支持数据为8位和无奇偶检验的异步模式
（如大多数计算机上都普遍存在的串行接口），还支持面向比特的同步链接。
2) 建立、配置及测试数据链路的链路控制协议（ L C P：Link Control Protocol）。它允许通
信双方进行协商，以确定不同的选项。
3) 针对不同网络层协议的网络控制协议（ N C P：Network Control Protocol）体系。当前
R F C定义的网络层有I P、O S I网络层、D E C n e t以及A p p l e Ta l k。例如，IP NCP允许双方商定是
否对报文首部进行压缩，类似于C S L I P（缩写词N C P也可用在T C P的前面）。

如图：

![PPP报文封装](./images/l2_ppp.png)


每一帧都以标志字符0 x 7 e开始和结束。紧接着是一个地址字节，值始终是0 x ff，然后是一
个值为0 x 0 3的控制字节。

接下来是协议字段，类似于以太网中类型字段的功能。当它的值为0 x 0 0 2 1时，表示信息
字段是一个I P数据报；值为0 x c 0 2 1时，表示信息字段是链路控制数据；值为0 x 8 0 2 1时，表示
信息字段是网络控制数据。

C R C字段（或F C S，帧检验序列）是一个循环冗余检验码，以检测数据帧中的错误。
由于标志字符的值是0 x 7 e，因此当该字符出现在信息字段中时， P P P需要对它进行转义。
在同步链路中，该过程是通过一种称作比特填充(bit stuff i n g )的硬件技术来完成的[ Ta n e n b a u m
1 9 8 9 ]。在异步链路中，特殊字符0 x 7 d用作转义字符。当它出现在P P P数据帧中时，那么紧接
着的字符的第6个比特要取其补码，具体实现过程如下：

1. 当遇到字符0 x 7 e时，需连续传送两个字符： 0 x 7 d和0 x 5 e，以实现标志字符的转义。
1. 当遇到转义字符0 x 7 d时，需连续传送两个字符： 0 x 7 d和0 x 5 d，以实现转义字符的转义。
1. 默认情况下，如果字符的值小于0 x 2 0（比如，一个A S C I I控制字符），一般都要进行转
义。例如，遇到字符0 x 0 1时需连续传送0 x 7 d和0 x 2 1两个字符（这时，第6个比特取补码后变为
1，而前面两种情况均把它变为0）。

这样做的原因是防止它们出现在双方主机的串行接口驱动程序或调制解调器中，因为有
时它们会把这些控制字符解释成特殊的含义。另一种可能是用链路控制协议来指定是否需要
对这3 2个字符中的某一些值进行转义。默认情况下是对所有的3 2个字符都进行转义。
与S L I P类似，由于P P P经常用于低速的串行链路，因此减少每一帧的字节数可以降低应用
程序的交互时延。利用链路控制协议，大多数的产品通过协商可以省略标志符和地址字段，
并且把协议字段由2个字节减少到1个字节.另外，使用I P网络控制协议，大多数的产品可以通过协商采用Van Jacobson报
文首部压缩方法（对应于C S L I P压缩），减小I P和T C P首部长度。

总的来说， P P P比S L I P具有下面这些优点： 

1. PPP支持在单根串行线路上运行多种协议，
不只是I P协议；
2.  每一帧都有循环冗余检验； 
3.  通信双方可以进行I P地址的动态协商(使用I P网络控制协议)； 
4.  与C S L I P类似，对T C P和I P报文首部进行压缩； 
5.  链路控制协议可以对多个数据链路选项进行设置。为这些优点付出的代价是在每一帧的首部增加3个字节，当建立链路时要发送几帧协商数据，以及更为复杂的实现。

## 重点知识点

1. 802.3协议要求数据部分最小长度为38字节
2. 以太网协议要求数据部分最小长度为46字节
3. 所以网络数据包最小长度64字节
   * 802.3头 + 最小数据长度 + CRC检验码 ，即： 22 + 38 + 4 = 64字节
   * 以太网头 + 最小数据长度 + CRC检验码 ，即： 14 + 46 + 4 = 64字节
4. MTU 最大传输单元，以太网和802.3对数据帧的长度都有限制，最大值分别是1500和1492
5. 路径MTU，网络上两台主机通信路径中，最小的MTU就是路径MTU
6. 路径MTU发现，[RFC1192]()
  


